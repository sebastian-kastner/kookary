<template>
  <div v-if="filterMenuOpen" id="filter-menu" class="p-4">
    <div class="d-flex justify-content-between">
      <h3>Filtern & Sortieren</h3>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        @click="closeMenu"
      ></button>
    </div>
    <div class="filter-menu-row">
      <recipe-order-by :recipe-filter="localFilter" @orderingUpdated="onFilterUpdate" />
    </div>
    <div class="filter-menu-row">
      <name-filter-component :recipe-filter="localFilter" @filterUpdated="onFilterUpdate" />
    </div>
    <div class="filter-menu-row">
      <div class="filter-menu-row-head">
        <Icon icon="calendarWeek" />Saisonalit√§t
      </div>
      <div class="filter-menu-row-body">
        <div class="form-check">
          <input
            id="is-seasonal-filter"
            class="form-check-input"
            type="checkbox"
            value=""
          />
          <label class="form-check-label" for="is-seasonal-filter">
            Nur saisonale Rezepte
          </label>
        </div>
      </div>
    </div>
    <div class="filter-menu-row">
      <div class="filter-menu-row-head"><Icon icon="bag" />Zutaten</div>
      <div class="filter-menu-row-body">
        <input type="text" class="form-control" />
      </div>
    </div>
    <div class="filter-menu-row">
      <div class="filter-menu-row-head"><Icon icon="tags" />Tags</div>
      <div class="filter-menu-row-body">
        <input type="text" class="form-control" />
      </div>
    </div>
    <div class="filter-menu-row">
      <div class="filter-menu-row-head"><Icon icon="bell" />Merkliste</div>
      <div class="filter-menu-row-body">
        <div class="form-check">
          <input
            id="is-marked-filter"
            class="form-check-input"
            type="checkbox"
            value=""
          />
          <label class="form-check-label" for="is-marked-filter">
            Nur Rezepte auf Merkliste
          </label>
        </div>
      </div>
    </div>
    <div class="py-4">
      <button
        type="button"
        class="apply-filter btn btn-outline-primary"
        @click="applyFilter"
      >
        Filtern!
      </button>
    </div>
  </div>
</template>

<script lang="ts">
import { Vue, Component, Prop, Watch } from "vue-facing-decorator";
import { RecipeFilter } from "../../clients/RecipesClient";
import { Icon } from "@iconify/vue/dist/offline";
import cloneDeep from "lodash.clonedeep";

import RecipeOrderBy from "./RecipeOrderBy.vue";
import NameFilterComponent from "./NameFilterComponent.vue";

@Component({
  components: { Icon, RecipeOrderBy, NameFilterComponent },
})
export default class RecipeFilterMenu extends Vue {
  @Prop({ required: true }) filterMenuOpen!: boolean;
  @Prop({ required: true }) activeFilter!: RecipeFilter;

  localFilter: RecipeFilter | null = null;

  @Watch("filterMenuOpen")
  onFilterMenuOpenChanged() {
    if (this.filterMenuOpen) {
      console.log("cloning filter for edit..");
      this.localFilter = cloneDeep(this.activeFilter);
    }
  }

  closeMenu(): void {
    this.$emit("close-menu");
  }

  onFilterUpdate(): void {
    console.log(this.localFilter);
  }

  applyFilter() {
    if (!this.localFilter) {
      this.$emit("close-menu");
      return;
    }
    this.$emit("apply-filter", this.activeFilter);
  }
}
</script>

<style lang="scss" scoped>
@import "../../styles/variables.scss";

#filter-menu {
  position: fixed;
  top: 0;
  left: 0;
  min-width: 450px;
  height: 100vh;
  background-color: white;
  z-index: 9999;
  color: black;
  border: 1px solid darkgray;
  border-top-right-radius: 10px;
  border-bottom-right-radius: 10px;

  .apply-filter {
    width: 100%;
  }
}
</style>
